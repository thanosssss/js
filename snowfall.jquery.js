if(!Date.now){Date.now=function(){return new Date().getTime()}}(function(){var d=["webkit","moz"];for(var b=0;b<d.length&&!window.requestAnimationFrame;++b){var a=d[b];window.requestAnimationFrame=window[a+"RequestAnimationFrame"];window.cancelAnimationFrame=(window[a+"CancelAnimationFrame"]||window[a+"CancelRequestAnimationFrame"])}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var c=0;window.requestAnimationFrame=function(g){var f=Date.now();var e=Math.max(c+16,f);return setTimeout(function(){g(c=e)},e-f)};window.cancelAnimationFrame=clearTimeout}}());(function(a){a.snowfall=function(c,d){var s=[],n={flakeCount:35,flakeColor:"#ffffff",flakePosition:"absolute",flakeIndex:999999,minSize:1,maxSize:2,minSpeed:1,maxSpeed:5,round:false,shadow:false,collection:false,collectionHeight:40,deviceorientation:false},d=a.extend(n,d),b=function b(w,i){return Math.round(w+Math.random()*(i-w))};a(c).data("snowfall",this);function f(A,z,y,w){this.x=A;this.y=z;this.size=y;this.speed=w;this.step=0;this.stepSize=b(1,10)/100;if(d.collection){this.target=u[b(0,u.length-1)]}var i=null;if(d.image){i=document.createElement("img");i.src=d.image}else{i=document.createElement("div");a(i).css({background:d.flakeColor})}a(i).attr({"class":"snowfall-flakes",}).css({width:this.size,height:this.size,position:d.flakePosition,top:this.y,left:this.x,fontSize:0,zIndex:d.flakeIndex});if(a(c).get(0).tagName===a(document).get(0).tagName){a("body").append(a(i));c=a("body")}else{a(c).append(a(i))}this.element=i;this.update=function(){this.y+=this.speed;if(this.y>(p)-(this.size+6)){this.reset()}this.element.style.top=this.y+"px";this.element.style.left=this.x+"px";this.step+=this.stepSize;if(j===false){this.x+=Math.cos(this.step)}else{this.x+=(j+Math.cos(this.step))}if(d.collection){if(this.x>this.target.x&&this.x<this.target.width+this.target.x&&this.y>this.target.y&&this.y<this.target.height+this.target.y){var D=this.target.element.getContext("2d"),C=this.x-this.target.x,B=this.y-this.target.y,E=this.target.colData;if(E[parseInt(C)][parseInt(B+this.speed+this.size)]!==undefined||B+this.speed+this.size>this.target.height){if(B+this.speed+this.size>this.target.height){while(B+this.speed+this.size>this.target.height&&this.speed>0){this.speed*=0.5}D.fillStyle="#fff";if(E[parseInt(C)][parseInt(B+this.speed+this.size)]==undefined){E[parseInt(C)][parseInt(B+this.speed+this.size)]=1;D.fillRect(C,(B)+this.speed+this.size,this.size,this.size)}else{E[parseInt(C)][parseInt(B+this.speed)]=1;D.fillRect(C,B+this.speed,this.size,this.size)}this.reset()}else{this.speed=1;this.stepSize=0;if(parseInt(C)+1<this.target.width&&E[parseInt(C)+1][parseInt(B)+1]==undefined){this.x++}else{if(parseInt(C)-1>0&&E[parseInt(C)-1][parseInt(B)+1]==undefined){this.x--}else{D.fillStyle="#fff";D.fillRect(C,B,this.size,this.size);E[parseInt(C)][parseInt(B)]=1;this.reset()}}}}}}if(this.x+this.size>(r)-h||this.x<h){this.reset()}};this.reset=function(){this.y=0;this.x=b(h,r-h);this.stepSize=b(1,10)/100;this.size=b((d.minSize*100),(d.maxSize*100))/100;this.element.style.width=this.size+"px";this.element.style.height=this.size+"px";this.speed=b(d.minSpeed,d.maxSpeed)}}var t=0,p=a(c).height(),r=a(c).width(),h=0,v=0;if(d.collection!==false){var e=document.createElement("canvas");if(!!(e.getContext&&e.getContext("2d"))){var u=[],q=a(d.collection),x=d.collectionHeight;for(var t=0;t<q.length;t++){var k=q[t].getBoundingClientRect(),l=a("<canvas/>",{"class":"snowfall-canvas"}),m=[];if(k.top-x>0){a("body").append(l);l.css({position:d.flakePosition,left:k.left+"px",top:k.top-x+"px"}).prop({width:k.width,height:x});for(var o=0;o<k.width;o++){m[o]=[]}u.push({element:l.get(0),x:k.left,y:k.top-x,width:k.width,height:x,colData:m})}}}else{d.collection=false}}if(a(c).get(0).tagName===a(document).get(0).tagName){h=25}a(window).bind("resize",function(){p=a(c)[0].clientHeight;r=a(c)[0].offsetWidth});for(t=0;t<d.flakeCount;t+=1){s.push(new f(b(h,r-h),b(0,p),b((d.minSize*100),(d.maxSize*100))/100,b(d.minSpeed,d.maxSpeed)))}if(d.round){a(".snowfall-flakes").css({"-moz-border-radius":d.maxSize,"-webkit-border-radius":d.maxSize,"border-radius":d.maxSize})}if(d.shadow){a(".snowfall-flakes").css({"-moz-box-shadow":"1px 1px 1px #555","-webkit-box-shadow":"1px 1px 1px #555","box-shadow":"1px 1px 1px #555"})}var j=false;if(d.deviceorientation){a(window).bind("deviceorientation",function(i){j=i.originalEvent.gamma*0.1})}function g(){for(t=0;t<s.length;t+=1){s[t].update()}v=requestAnimationFrame(function(){g()})}g();this.clear=function(){a(".snowfall-canvas").remove();a(c).children(".snowfall-flakes").remove();cancelAnimationFrame(v)}};a.fn.snowfall=function(b){if(typeof(b)=="object"||b==undefined){return this.each(function(c){(new a.snowfall(this,b))})}else{if(typeof(b)=="string"){return this.each(function(c){var d=a(this).data("snowfall");if(d){d.clear()}})}}}})(jQuery);
